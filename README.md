
# MIYA LINGO: Руководство для разработчика

Это проект на Next.js, созданный в Firebase Studio. Приложение представляет собой интерактивную платформу для изучения японского языка с ИИ-ассистентом по имени Мия. Этот документ служит полным руководством по структуре, настройке и модификации проекта.

## 1. Обзор технологий

- **Фреймворк**: [Next.js](https://nextjs.org/) (App Router)
- **Язык**: [TypeScript](https://www.typescriptlang.org/)
- **UI Компоненты**: [ShadCN/UI](https://ui.shadcn.com/)
- **Стилизация**: [Tailwind CSS](https://tailwindcss.com/)
- **ИИ-функциональность**: [Genkit (Firebase)](https://firebase.google.com/docs/genkit)
- **Управление состоянием**: [Zustand](https://github.com/pmndrs/zustand)
- **Хостинг**: [Firebase App Hosting](https://firebase.google.com/docs/app-hosting)

## 2. Структура проекта

Ниже описана структура ключевых директорий и их назначение.

- `src/app/`: Основные страницы приложения. Каждый подкаталог — это новый маршрут (например, `/app/dictionary/page.tsx` — это страница `http://localhost:9002/dictionary`).
- `src/components/`: Переиспользуемые React-компоненты.
  - `src/components/ui/`: Базовые UI-компоненты от ShadCN (кнопки, карточки, и т.д.).
- `src/ai/`: Логика, связанная с искусственным интеллектом (Genkit).
  - `src/ai/genkit.ts`: **Центральный файл конфигурации Genkit**. Здесь инициализируется плагин Google AI.
  - `src/ai/flows/`: Файлы, определяющие логику взаимодействия с языковыми моделями (LLM). Каждый файл — это отдельный "поток" (flow).
- `src/lib/`: Вспомогательные утилиты и статические данные.
  - `src/lib/dictionary-data.ts`: **Словарные статьи, иероглифы и данные для тестов.**
  - `src/lib/utils.ts`: Утилита `cn` для стилизации.
- `src/hooks/`: Пользовательские React-хуки для управления состоянием и логикой.
- `public/`: Статические ассеты (изображения, звуки, иконки).

## 3. Как запустить

Для запуска проекта в режиме разработки выполните команду:

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:9002`.

Для отладки AI-функций в отдельном терминале можно запустить Genkit Developer UI:

```bash
npm run genkit:watch
```

## 4. Руководство по модификации

Этот раздел объясняет, как изменять ключевые части приложения.

### 4.1. Изменение ИИ-ассистента Мии

Вся логика поведения Мии находится в файле `src/ai/flows/miya-assistant-flow.ts`.

- **Чтобы изменить личность, тон или правила поведения Мии**:
  - Откройте `src/ai/flows/miya-assistant-flow.ts`.
  - Найдите константу `prompt`. Внутри неё находится длинная строка с системным промптом.
  - Редактируйте этот текст, чтобы изменить её характер, коронные фразы ("пон"), реакции и т.д.

- **Чтобы изменить используемую нейросеть (модель LLM)**:
  - В том же файле (`src/ai/flows/miya-assistant-flow.ts`) найдите определение `prompt`.
  - Измените значение поля `model`:
    ```ts
    const prompt = ai.definePrompt({
      // ...
      model: 'googleai/gemini-1.5-flash-latest', // <-- Замените эту строку
      // ...
    });
    ```
  - **Важно!** Не забудьте указать API-ключ для новой модели в файле `.env` и, при необходимости, подключить соответствующий плагин Genkit в `src/ai/genkit.ts`.

- **Чтобы добавить новые "секретные" режимы (как `affectionMode` или `koseiMode`)**:
  - В системном промпте опишите новое правило и триггерные фразы.
  - В схеме `MiyaOutputSchema` добавьте новое boolean-поле (например, `newMode: z.boolean().optional()`).
  - Убедитесь, что ваш промпт теперь просит модель устанавливать это поле в `true` при срабатывании триггера.

### 4.2. Работа с контентом уроков и тестов

- **Добавление/изменение слов в словаре**:
  - Откройте `src/lib/dictionary-data.ts`.
  - Найдите массив `n5`, `n4` и т.д. и добавьте или отредактируйте объекты `Word`.

- **Добавление/изменение иероглифов (кандзи)**:
  - Откройте `src/lib/dictionary-data.ts`.
  - Найдите массив `n5Kanji` и добавьте или отредактируйте объекты `Kanji`.

- **Добавление/изменение грамматических и фонетических примеров**:
  - Откройте `src/ai/precomputed-analysis.ts`.
  - Этот файл содержит "предварительно рассчитанный" анализ фраз, чтобы избежать лишних вызовов AI.
  - Добавьте новый объект в `phoneticsAnalyses` или `grammarAnalyses`, следуя существующей структуре `JapaneseAnalysisOutput`. Это позволит использовать фразу в компоненте `<InteractiveText />`.

### 4.3. Изменение внешнего вида (стилей)

- **Основные цвета приложения**:
  - Откройте `src/app/globals.css`.
  - Найдите блок `:root` и измените значения HSL для переменных `--background`, `--primary`, `--accent` и т.д.

- **Стили для "Режима Учителя"**:
  - В том же файле (`src/app/globals.css`) найдите блок `.teacher-mode`.
  - Измените CSS-переменные внутри него, чтобы настроить цветовую схему для этого режима.

### 4.4. Управление состоянием на клиенте

- **Прогресс изучения слов**:
  - Логика интервальных повторений и отслеживания прогресса находится в хуке `src/hooks/use-word-progress.ts`.
  - Вы можете изменить интервалы повторений в константе `SRS_INTERVALS_HOURS` или количество новых слов в день в функции `getReviewQueue`.

- **Состояние "Режима Учителя"**:
  - Управляется через хук `src/hooks/use-teacher-mode.ts`. Данные хранятся в `localStorage`.

- **Копирование в буфер обмена и всплывающие уведомления**:
  - Реализованы в хуках `src/hooks/use-copy-to-clipboard.ts` и `src/hooks/use-toast.ts` соответственно.

## 5. Зависимости и конфигурация

- **Управление пакетами**: `package.json` содержит список всех зависимостей. После добавления нового пакета просто перезапустите сервер разработки — `npm` зависимости устанавливаются автоматически.
- **Конфигурация Next.js**: `next.config.ts` используется для настройки правил сборки, ESLint, TypeScript и оптимизации изображений.
- **Конфигурация сервера App Hosting**: `apphosting.yaml` определяет настройки серверной части, например, максимальное количество экземпляров (`maxInstances`).
